{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/sql/groupby/",
    "result": {"data":{"site":{"siteMetadata":{"title":"🏃🏻UndefinedP.log","author":"UndefinedP","siteUrl":"https://undefinedp.github.io","comment":{"disqusShortName":"","utterances":"undefinedP/undefinedp.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"5b96da72-7400-51de-9b8c-cb1c6a1aff70","excerpt":"슉.슈슉.내.내한테.왜.이러는.데. 음~^^ 그럴 줄 알았습니다~^^ 라고 말할 수 있을 정도로 정말 정말 많이 보는 에러이다. 그런데 이 에러 도대체 왜 발생하는걸까?! GROUP BY GROUP BY는 같은 값을 가진 행끼리 하나의 그룹으로 뭉춰주는 역할을 한다. 아래의 예시를 보면 더 빠르게 이해가 갈 것이다. group by 이는 Employee라는 테이블에서 DeptID를 기준으로 그룹핑해서 Salary의 평균을 구한걸 보여주고 있다. 위처럼 보통 GROUP BY…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZ0lEQVQI1z2O2Q3AMAhDM1Ga+yTX/kO5EKn9eAIMtlD0GMwxsM/BWusy58RgTZCeiFBrRSkFMUZoreGcQ+8dxPgQEJ2HNQYq6QetNuy9f0NKCTnnO3+atfZi2CSBUgMHya3oXnb83AvYmEF7kjOfygAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error\"\n        title=\"error\"\n        src=\"/static/e3c98bda5b80d3d49174b6fbb76dd1ab/c1b63/groupby_error.png\"\n        srcset=\"/static/e3c98bda5b80d3d49174b6fbb76dd1ab/5a46d/groupby_error.png 300w,\n/static/e3c98bda5b80d3d49174b6fbb76dd1ab/0a47e/groupby_error.png 600w,\n/static/e3c98bda5b80d3d49174b6fbb76dd1ab/c1b63/groupby_error.png 1200w,\n/static/e3c98bda5b80d3d49174b6fbb76dd1ab/a8a6f/groupby_error.png 1516w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n슉.슈슉.내.내한테.왜.이러는.데.</p>\n<hr>\n<p>음~^^ 그럴 줄 알았습니다~^^ 라고 말할 수 있을 정도로 정말 정말 많이 보는 에러이다. 그런데 이 에러 도대체 왜 발생하는걸까?!</p>\n<h2 id=\"group-by\" style=\"position:relative;\"><a href=\"#group-by\" aria-label=\"group by permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GROUP BY</h2>\n<p>GROUP BY는 같은 값을 가진 행끼리 하나의 그룹으로 뭉춰주는 역할을 한다. 아래의 예시를 보면 더 빠르게 이해가 갈 것이다.</p>\n<p><img src=\"https://media.vlpt.us/images/dntjd7701/post/c759d336-1c98-40d3-bddf-83d08efd2506/image.png\" alt=\"group by\"></p>\n<p>이는 Employee라는 테이블에서 DeptID를 기준으로 그룹핑해서 Salary의 평균을 구한걸 보여주고 있다.</p>\n<p>위처럼 보통 GROUP BY절은 집계 함수와 같이 사용되고는 하는데, 집계 함수는 여러 행의 값을 더하거나, 평균 값을 내거나, 개수를 세는 등 여러 개의 데이터에 관한 계산을 한다.</p>\n<p>주로 사용하는 집계 함수에는 <code class=\"language-text\">COUNT()</code>, <code class=\"language-text\">AVG()</code>, <code class=\"language-text\">MIN()</code>, <code class=\"language-text\">MAX()</code>, <code class=\"language-text\">SUM()</code> 등이 있다.</p>\n<h2 id=\"coulum-must-apper-in-the-group-by-clause-\" style=\"position:relative;\"><a href=\"#coulum-must-apper-in-the-group-by-clause-\" aria-label=\"coulum must apper in the group by clause  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coulum must apper in the GROUP BY clause …</h2>\n<p>아래와 같은 테이블이 있다고 하자.</p>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>name</th>\n<th>location</th>\n<th>cvs</th>\n<th>purchases</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>KIM</td>\n<td>SEOUL</td>\n<td>GS25</td>\n<td>20000</td>\n</tr>\n<tr>\n<td>2</td>\n<td>LEE</td>\n<td>SEOUL</td>\n<td>Emart24</td>\n<td>300</td>\n</tr>\n<tr>\n<td>3</td>\n<td>PARK</td>\n<td>BUSAN</td>\n<td>GS25</td>\n<td>4500</td>\n</tr>\n<tr>\n<td>4</td>\n<td>CHOI</td>\n<td>DAEGU</td>\n<td>CU</td>\n<td>90000</td>\n</tr>\n<tr>\n<td>5</td>\n<td>KANG</td>\n<td>BUSAN</td>\n<td>Emart24</td>\n<td>34000</td>\n</tr>\n<tr>\n<td>6</td>\n<td>YOON</td>\n<td>DAEGU</td>\n<td>CU</td>\n<td>2400</td>\n</tr>\n</tbody>\n</table>\n<p>우리는 특정 편의점에서 발생한 구매액의 총액을 알고싶을 때, 이런식으로 쿼리를 쓸 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> location<span class=\"token punctuation\">,</span> cvs<span class=\"token punctuation\">,</span> <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>purchases<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> sum\n<span class=\"token keyword\">FROM</span> <span class=\"token keyword\">table</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> cvs<span class=\"token punctuation\">;</span></code></pre></div>\n<p>그런데 이런 쿼리로 실행하면 에러가 날것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ERROR: column 'table.location' must appear in the\nGROUP BY clause or be used in an aggregate function</code></pre></div>\n<p>이게 머..머선 소리고..</p>\n<h2 id=\"그래서-뭘-잘못했을까\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%AD%98-%EC%9E%98%EB%AA%BB%ED%96%88%EC%9D%84%EA%B9%8C\" aria-label=\"그래서 뭘 잘못했을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 뭘 잘못했을까?</h2>\n<p>위의 쿼리를 잘 보자. Select를 해오는 컬럼은 총 세 가지이다. location, cvs, average. 그런데 group by 절에서는 cvs를 기준으로 묶는다고 적혀있고, 값은 집계함수인 SUM()함수를 사용해서 묶어주고 있다. 그런데 location은? 아무것도 없다! 그러니까 데이터베이스는 혼란이 온 것이다. 아니…뭘로…데이터를 그룹핑해야할지 모르겠어용…하면서 반환한 것이 위의 에러이다.</p>\n<h2 id=\"해결방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\" aria-label=\"해결방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결방법</h2>\n<h3 id=\"1-group-by-절에-추가\" style=\"position:relative;\"><a href=\"#1-group-by-%EC%A0%88%EC%97%90-%EC%B6%94%EA%B0%80\" aria-label=\"1 group by 절에 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. GROUP BY 절에 추가</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> location<span class=\"token punctuation\">,</span> cvs<span class=\"token punctuation\">,</span> <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>purchases<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> sum\n<span class=\"token keyword\">FROM</span> <span class=\"token keyword\">table</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> cvs<span class=\"token punctuation\">,</span> location</code></pre></div>\n<p>이런식으로 location까지 추가를 하게 되면, 편의점 별로, 또 위치별로 그룹핑이 될 것이다.</p>\n<table>\n<thead>\n<tr>\n<th>location</th>\n<th>cvs</th>\n<th>sum</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SEOUL</td>\n<td>GS25</td>\n<td>20000</td>\n</tr>\n<tr>\n<td>SEOUL</td>\n<td>Emart24</td>\n<td>300</td>\n</tr>\n<tr>\n<td>BUSAN</td>\n<td>GS25</td>\n<td>4500</td>\n</tr>\n<tr>\n<td>BUSAN</td>\n<td>Emart24</td>\n<td>34000</td>\n</tr>\n<tr>\n<td>DAEGU</td>\n<td>CU</td>\n<td>92400</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-select문에서-지우기\" style=\"position:relative;\"><a href=\"#2-select%EB%AC%B8%EC%97%90%EC%84%9C-%EC%A7%80%EC%9A%B0%EA%B8%B0\" aria-label=\"2 select문에서 지우기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. SELECT문에서 지우기</h3>\n<p>만약에 location이 필요가 없다면 없애는것도 하나의 방법이 된다. 그냥 편의점별로 총 액을 구하고싶다면, location은 있어봤자 필요없는 정보가 될 뿐이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> cvs<span class=\"token punctuation\">,</span> <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>purchases<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> sum\n<span class=\"token keyword\">FROM</span> <span class=\"token keyword\">table</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> cvs</code></pre></div>\n<table>\n<thead>\n<tr>\n<th>cvs</th>\n<th>sum</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GS25</td>\n<td>24500</td>\n</tr>\n<tr>\n<td>Emart24</td>\n<td>34300</td>\n</tr>\n<tr>\n<td>CU</td>\n<td>92400</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-집계함수를-사용\" style=\"position:relative;\"><a href=\"#3-%EC%A7%91%EA%B3%84%ED%95%A8%EC%88%98%EB%A5%BC-%EC%82%AC%EC%9A%A9\" aria-label=\"3 집계함수를 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 집계함수를 사용</h3>\n<p>에러에서도 나오듯이 집계함수를 사용할 수도 있다. COUNT, SUM, AVG 등등..내가 필요한 함수를 잘 활용해서 사용한다면 GROUP BY에서 에러가 발생하지 않을 것이다.</p>\n<p>아니면 GROUP BY절을 사용하지 않고, <a href=\"https://www.postgresql.org/docs/9.1/tutorial-window.html\">window function</a>을 사용하는 것도 하나의 방법이 된다.</p>","frontmatter":{"title":"[PostgreSQL]column must appear in the GROUP BY clause or be used in an aggregate function","date":"March 13, 2022"}}},"pageContext":{"slug":"/sql/groupby/","previous":{"fields":{"slug":"/Node/node_schedule/"},"frontmatter":{"title":"node-schedule을 이용해서 특정시간에 이벤트를 발생시키기"}},"next":null}},
    "staticQueryHashes": ["2486386679","3128451518"]}